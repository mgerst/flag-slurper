import pytest
from hypothesis import given, assume
from hypothesis.strategies import text

from flag_slurper.autolib import exploit


@pytest.mark.parametrize('err', exploit.FILTERED_ERRORS)
def test_log_error_filtered(mocker, err):
    logger = mocker.MagicMock()
    mocker.patch('flag_slurper.autolib.exploit.logger.error', logger)
    exploit.log_error('There was an error', 'test', err)
    assert not logger.called


@given(err=text())
def test_log_error(mocker, err):
    assume(err not in exploit.FILTERED_ERRORS)
    logger = mocker.MagicMock()
    mocker.patch('flag_slurper.autolib.exploit.logger.error', logger)
    exploit.log_error('There was an error', 'test', err)
    assert logger.called
